<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>SlideMind</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet"/>
<style>
:root{
  --bg:#07090f;
  --bg2:#0d1017;
  --card:#111520;
  --card2:#161b28;
  --border:rgba(255,255,255,.07);
  --text:#e8eeff;
  --muted:#5a6488;
  --accent:#5b7bff;
  --accent2:#8b5cf6;
  --green:#00e08a;
  --amber:#f59e0b;
  --red:#f43f5e;
  --purple:#a855f7;
  --teal:#14b8a6;
  --r:14px;
  --grad:linear-gradient(135deg,#5b7bff,#8b5cf6);
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;overflow:hidden;}
body{font-family:'Space Grotesk',sans-serif;background:var(--bg);color:var(--text);display:flex;flex-direction:column;}

.page{display:none;flex:1;overflow-y:auto;padding-bottom:84px;}
.page.active{display:block;animation:fadeUp .28s cubic-bezier(.4,0,.2,1);}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px);}to{opacity:1;transform:translateY(0);}}

::-webkit-scrollbar{width:2px;}
::-webkit-scrollbar-thumb{background:rgba(91,123,255,.3);border-radius:10px;}

.bnav{
  position:fixed;bottom:0;left:0;right:0;z-index:100;
  background:rgba(7,9,15,.92);
  backdrop-filter:blur(24px);
  border-top:1px solid var(--border);
  display:flex;
  padding-bottom:env(safe-area-inset-bottom);
}
.bni{flex:1;display:flex;flex-direction:column;align-items:center;padding:.6rem .3rem;cursor:pointer;gap:.2rem;position:relative;}
.bni-icon{font-size:1.2rem;transition:transform .25s cubic-bezier(.34,1.56,.64,1);}
.bni-label{font-size:.55rem;font-weight:700;color:var(--muted);transition:color .2s;letter-spacing:.06em;text-transform:uppercase;}
.bni.active .bni-label{color:var(--accent);}
.bni.active .bni-icon{transform:scale(1.2);}
.bni.active::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:28px;height:2px;background:var(--accent);border-radius:0 0 4px 4px;}

.phead{padding:1.1rem 1.1rem .4rem;}
.phead h1{font-family:'Sora',sans-serif;font-weight:800;font-size:1.4rem;line-height:1.2;letter-spacing:-.02em;}
.phead p{color:var(--muted);font-size:.75rem;margin-top:.2rem;}
.back-btn{background:var(--card);border:1px solid var(--border);color:var(--text);padding:.4rem .9rem;border-radius:50px;font-weight:600;font-size:.75rem;margin-bottom:.75rem;display:inline-flex;align-items:center;gap:.35rem;cursor:pointer;}

.hero-banner{
  margin:.25rem 1.1rem .75rem;
  border-radius:18px;padding:1.35rem;
  position:relative;overflow:hidden;min-height:130px;
  display:flex;flex-direction:column;justify-content:flex-end;
  cursor:pointer;
}
.hb-bg{position:absolute;inset:0;z-index:0;}
.hb-noise{position:absolute;inset:0;opacity:.04;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");z-index:1;}
.hb-circle1{position:absolute;width:160px;height:160px;border-radius:50%;background:rgba(255,255,255,.05);top:-50px;right:-30px;z-index:1;}
.hb-circle2{position:absolute;width:100px;height:100px;border-radius:50%;background:rgba(255,255,255,.04);bottom:-20px;left:20px;z-index:1;}
.hb-emoji{position:absolute;right:1.1rem;top:50%;transform:translateY(-50%);font-size:3rem;z-index:2;filter:drop-shadow(0 6px 14px rgba(0,0,0,.5));}
.hb-content{position:relative;z-index:2;}
.hero-banner h2{font-family:'Sora',sans-serif;font-weight:800;font-size:1rem;margin-bottom:.25rem;letter-spacing:-.01em;}
.hero-banner p{font-size:.73rem;opacity:.75;margin-bottom:.7rem;max-width:62%;}
.hb-btn{background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.25);color:#fff;padding:.38rem 1rem;border-radius:50px;font-weight:700;font-size:.72rem;display:inline-flex;align-items:center;gap:.35rem;backdrop-filter:blur(8px);}

.slider-dots{display:flex;justify-content:center;gap:.35rem;margin-bottom:.75rem;}
.sdot{width:5px;height:5px;border-radius:50%;background:var(--border);transition:all .3s;}
.sdot.active{background:var(--accent);width:16px;border-radius:10px;}

.section{padding:.6rem 1.1rem;}
.sec-title{font-family:'Sora',sans-serif;font-weight:700;font-size:.7rem;margin-bottom:.65rem;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;}

.action-list{display:flex;flex-direction:column;gap:.5rem;}
.action-card{
  background:var(--card);border:1px solid var(--border);border-radius:var(--r);
  padding:.9rem 1rem;display:flex;align-items:center;gap:.75rem;
  cursor:pointer;transition:all .18s;
}
.action-card:active{transform:scale(.99);background:var(--card2);}
.ac-icon{width:40px;height:40px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0;}
.ac-body{flex:1;min-width:0;}
.ac-body h3{font-weight:700;font-size:.85rem;margin-bottom:.1rem;display:flex;align-items:center;gap:.35rem;}
.ac-body p{font-size:.7rem;color:var(--muted);}
.ac-arr{color:var(--muted);font-size:.9rem;flex-shrink:0;}
.new-tag{background:var(--accent2);color:#fff;font-size:.55rem;font-weight:800;padding:.08rem .4rem;border-radius:50px;letter-spacing:.03em;}
.hot-tag{background:var(--amber);color:#000;font-size:.55rem;font-weight:800;padding:.08rem .4rem;border-radius:50px;}

.credit-pill{background:var(--card);border:1px solid var(--border);border-radius:50px;padding:.35rem .8rem;display:flex;align-items:center;gap:.3rem;font-weight:700;font-size:.78rem;cursor:pointer;}
.cp-dot{width:7px;height:7px;border-radius:50%;background:var(--amber);}

.btn{display:flex;align-items:center;justify-content:center;gap:.45rem;padding:.75rem;border-radius:50px;border:none;font-family:'Space Grotesk',sans-serif;font-weight:700;font-size:.85rem;cursor:pointer;transition:all .2s;width:100%;}
.btn-grad{background:var(--grad);color:#fff;box-shadow:0 4px 20px rgba(91,123,255,.25);}
.btn-grad:active{transform:scale(.98);opacity:.9;}
.btn-outline{background:transparent;border:1.5px solid var(--border);color:var(--text);}
.btn-outline:active{background:var(--card2);}
.btn-sm{padding:.45rem 1rem;font-size:.75rem;width:auto;border-radius:50px;}
.btn-green{background:var(--green);color:#000;}
.btn-teal{background:var(--teal);color:#000;}

.form-field{margin-bottom:.85rem;}
.form-field label{display:block;font-size:.68rem;font-weight:700;color:var(--muted);margin-bottom:.35rem;text-transform:uppercase;letter-spacing:.06em;}
.form-field input,.form-field textarea,.form-field select{
  width:100%;background:var(--card2);border:1.5px solid var(--border);
  border-radius:11px;padding:.7rem .9rem;color:var(--text);
  font-family:'Space Grotesk',sans-serif;font-size:.85rem;
  outline:none;transition:border-color .2s;resize:none;
}
.form-field input:focus,.form-field textarea:focus,.form-field select:focus{border-color:var(--accent);}
select option{background:var(--bg2);}

.wiz-steps{display:flex;gap:.35rem;margin-bottom:1.1rem;}
.wstep{flex:1;height:3px;border-radius:10px;background:var(--border);transition:all .3s;}
.wstep.done{background:var(--green);}
.wstep.active{background:var(--accent);}

.choice-grid{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;}
.choice-btn{background:var(--card);border:2px solid var(--border);border-radius:12px;padding:.75rem;text-align:center;cursor:pointer;transition:all .18s;}
.choice-btn:active{transform:scale(.97);}
.choice-btn.sel{border-color:var(--accent);background:rgba(91,123,255,.08);}
.cb-icon{font-size:1.3rem;margin-bottom:.25rem;}
.cb-name{font-weight:700;font-size:.78rem;}
.cb-desc{font-size:.65rem;color:var(--muted);margin-top:.08rem;}

.count-pills{display:flex;flex-wrap:wrap;gap:.45rem;}
.cpill{background:var(--card);border:2px solid var(--border);border-radius:50px;padding:.35rem .85rem;font-weight:700;font-size:.82rem;cursor:pointer;transition:all .2s;font-family:'Sora',sans-serif;}
.cpill.sel{border-color:var(--accent);color:var(--accent);background:rgba(91,123,255,.08);}

.gen-wrap{padding:2.5rem 1.1rem;text-align:center;}
.gen-anim{font-size:2.8rem;animation:spin 1.8s linear infinite;display:inline-block;margin-bottom:1rem;}
@keyframes spin{to{transform:rotate(360deg);}}
.pbar-bg{background:var(--card2);border-radius:10px;height:6px;margin:1rem 0 .5rem;overflow:hidden;}
.pbar{background:var(--grad);height:6px;border-radius:10px;transition:width .5s cubic-bezier(.4,0,.2,1);}

.quiz-header{padding:1rem 1.1rem .6rem;border-bottom:1px solid var(--border);}
.qh-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:.55rem;}
.qh-counter{font-weight:700;font-size:.78rem;color:var(--muted);}
.qh-timer{background:var(--card2);border:1px solid var(--border);padding:.28rem .7rem;border-radius:50px;font-weight:700;font-size:.78rem;font-family:'JetBrains Mono',monospace;}
.qh-timer.danger{background:rgba(244,63,94,.1);border-color:var(--red);color:var(--red);animation:pulse .7s infinite;}
@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.04);}}
.qpbar-bg{background:var(--card2);height:4px;border-radius:10px;overflow:hidden;}
.qpbar{background:var(--grad);height:4px;border-radius:10px;transition:width .4s;}
.quiz-body{padding:1.1rem 1.1rem;}
.q-num{font-size:.65rem;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:.08em;margin-bottom:.4rem;}
.q-text{font-family:'Sora',sans-serif;font-weight:700;font-size:1rem;line-height:1.5;margin-bottom:1.1rem;}
.options{display:flex;flex-direction:column;gap:.5rem;}
.opt{display:flex;align-items:center;gap:.7rem;background:var(--card);border:2px solid var(--border);border-radius:12px;padding:.8rem .9rem;cursor:pointer;transition:all .18s;}
.opt:active{transform:scale(.99);}
.opt.sel{border-color:var(--accent);background:rgba(91,123,255,.08);}
.opt.correct{border-color:var(--green);background:rgba(0,224,138,.06);}
.opt.wrong{border-color:var(--red);background:rgba(244,63,94,.06);}
.opt-letter{width:28px;height:28px;border-radius:50%;background:var(--card2);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.72rem;flex-shrink:0;transition:all .2s;}
.opt.sel .opt-letter{background:var(--accent);color:#fff;}
.opt.correct .opt-letter{background:var(--green);color:#000;}
.opt.wrong .opt-letter{background:var(--red);color:#fff;}
.quiz-nav{display:flex;justify-content:space-between;align-items:center;padding:.9rem 1.1rem;border-top:1px solid var(--border);gap:.5rem;position:sticky;bottom:0;background:var(--bg);}
.qdots{display:flex;gap:.28rem;flex:1;justify-content:center;flex-wrap:wrap;}
.qdot{width:8px;height:8px;border-radius:50%;background:var(--border);cursor:pointer;transition:all .2s;}
.qdot.ans{background:var(--accent);}
.qdot.cur{background:var(--amber);transform:scale(1.3);}

.result-hero{background:linear-gradient(135deg,rgba(91,123,255,.08),rgba(139,92,246,.08));border:1px solid rgba(91,123,255,.18);border-radius:18px;padding:1.5rem;text-align:center;margin:1.1rem;}
.rh-ring{width:100px;height:100px;border-radius:50%;border:4px solid;margin:0 auto .85rem;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.rh-pct{font-family:'Sora',sans-serif;font-size:2rem;font-weight:800;line-height:1;}
.rh-sub{font-size:.65rem;font-weight:600;color:var(--muted);}
.res-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:.5rem;margin:1rem 1.1rem;}
.rs{background:var(--card);border-radius:11px;padding:.75rem;text-align:center;}
.rs .rv{font-family:'Sora',sans-serif;font-size:1.25rem;font-weight:800;}
.rs .rl{font-size:.62rem;color:var(--muted);font-weight:600;margin-top:.08rem;}

.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;}
.stat-box{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:.85rem;text-align:center;}
.stat-box .sv{font-family:'Sora',sans-serif;font-size:1.5rem;font-weight:800;color:var(--accent);}
.stat-box .sl{font-size:.63rem;font-weight:700;color:var(--muted);margin-top:.12rem;text-transform:uppercase;letter-spacing:.05em;}

.card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);padding:1rem;margin-bottom:.65rem;}
.card-title{font-family:'Sora',sans-serif;font-weight:700;font-size:.85rem;margin-bottom:.75rem;display:flex;align-items:center;gap:.45rem;}

.pkg-list{display:flex;flex-direction:column;gap:.5rem;}
.pkg-card{background:var(--card);border:2px solid var(--border);border-radius:var(--r);padding:.9rem 1rem;display:flex;align-items:center;gap:.75rem;cursor:pointer;transition:all .2s;position:relative;}
.pkg-card.pop{border-color:var(--amber);}
.pkg-hot{position:absolute;top:-8px;right:.9rem;background:var(--amber);color:#000;font-size:.58rem;font-weight:800;padding:.12rem .5rem;border-radius:50px;}
.pkg-icon{width:42px;height:42px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0;}
.pkg-body{flex:1;}
.pkg-name{font-weight:700;font-size:.82rem;margin-bottom:.12rem;}
.pkg-price{font-family:'Sora',sans-serif;font-size:1.15rem;font-weight:800;color:var(--accent);}
.pkg-sub{font-size:.68rem;color:var(--muted);}

.plan-cards{display:flex;flex-direction:column;gap:.6rem;margin-bottom:.9rem;}
.plan-card{background:var(--card);border:2px solid var(--border);border-radius:var(--r);padding:1rem;cursor:pointer;transition:all .2s;position:relative;}
.plan-card.pop{border-color:var(--accent);}
.plan-card.sel{border-color:var(--green);background:rgba(0,224,138,.04);}
.pc-top{display:flex;justify-content:space-between;align-items:flex-start;}
.pc-name{font-family:'Sora',sans-serif;font-weight:800;font-size:.95rem;}
.pc-price{font-family:'Sora',sans-serif;font-size:1.25rem;font-weight:800;color:var(--accent);}
.pc-sub{font-size:.65rem;color:var(--muted);}
.pc-feats{display:flex;flex-wrap:wrap;gap:.35rem;margin-top:.55rem;}
.pc-feat{background:rgba(255,255,255,.05);border-radius:50px;padding:.18rem .55rem;font-size:.65rem;font-weight:600;}

.prof-card{background:linear-gradient(135deg,#111a50,#0e0a2e);border:1px solid rgba(91,123,255,.18);border-radius:18px;padding:1.35rem;margin:0 1.1rem .85rem;position:relative;overflow:hidden;}
.prof-card::before{content:'';position:absolute;width:180px;height:180px;background:rgba(91,123,255,.08);border-radius:50%;top:-50px;right:-50px;}
.prof-av{width:54px;height:54px;border-radius:50%;background:var(--grad);display:flex;align-items:center;justify-content:center;font-size:1.4rem;margin-bottom:.75rem;}
.prof-name{font-family:'Sora',sans-serif;font-weight:800;font-size:1.1rem;}
.prof-plan{display:inline-flex;align-items:center;gap:.3rem;padding:.2rem .65rem;border-radius:50px;font-size:.68rem;font-weight:700;margin-top:.3rem;}
.plan-free{background:rgba(255,255,255,.07);color:var(--muted);}
.plan-premium{background:linear-gradient(135deg,rgba(245,158,11,.15),rgba(239,68,68,.1));color:var(--amber);border:1px solid rgba(245,158,11,.25);}

.ref-box{background:rgba(91,123,255,.07);border:1.5px solid rgba(91,123,255,.18);border-radius:11px;padding:.9rem;font-family:'JetBrains Mono',monospace;font-size:.73rem;word-break:break-all;margin-bottom:.75rem;cursor:pointer;}

.pay-grid{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin:.75rem 0;}
.pay-m{background:var(--card);border:2px solid var(--border);border-radius:12px;padding:.75rem;text-align:center;cursor:pointer;transition:all .2s;}
.pay-m.sel{border-color:var(--accent);}
.pay-m .pm-icon{font-size:1.3rem;margin-bottom:.2rem;}
.pay-m .pm-name{font-size:.72rem;font-weight:700;}

.toast-wrap{position:fixed;top:1rem;left:50%;transform:translateX(-50%);z-index:999;display:flex;flex-direction:column;gap:.35rem;pointer-events:none;}
.toast{background:#161b28;border:1px solid var(--border);color:var(--text);padding:.6rem 1.1rem;border-radius:50px;font-size:.76rem;font-weight:600;white-space:nowrap;opacity:0;transform:translateY(-8px);transition:all .25s;}
.toast.show{opacity:1;transform:translateY(0);}

/* ARTICLE WRITER */
.article-type-grid{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-bottom:.85rem;}
.at-card{background:var(--card);border:2px solid var(--border);border-radius:12px;padding:.85rem .7rem;text-align:center;cursor:pointer;transition:all .2s;position:relative;}
.at-card:active{transform:scale(.97);}
.at-card.sel{border-color:var(--teal);background:rgba(20,184,166,.07);}
.at-icon{font-size:1.5rem;margin-bottom:.3rem;}
.at-name{font-weight:700;font-size:.78rem;}
.at-desc{font-size:.62rem;color:var(--muted);margin-top:.06rem;}

.tone-pills{display:flex;flex-wrap:wrap;gap:.4rem;}
.tone-pill{background:var(--card);border:2px solid var(--border);border-radius:50px;padding:.3rem .75rem;font-weight:600;font-size:.73rem;cursor:pointer;transition:all .2s;}
.tone-pill.sel{border-color:var(--teal);color:var(--teal);background:rgba(20,184,166,.08);}

.length-pills{display:flex;gap:.4rem;flex-wrap:wrap;}
.lpill{background:var(--card);border:2px solid var(--border);border-radius:50px;padding:.32rem .8rem;font-weight:600;font-size:.73rem;cursor:pointer;transition:all .2s;}
.lpill.sel{border-color:var(--teal);color:var(--teal);background:rgba(20,184,166,.08);}

.article-result-wrap{padding:1rem 1.1rem;padding-bottom:100px;}
.article-meta{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:.85rem;}
.article-meta span{background:rgba(20,184,166,.1);border:1px solid rgba(20,184,166,.2);color:var(--teal);border-radius:50px;padding:.18rem .6rem;font-size:.65rem;font-weight:700;}
.article-title{font-family:'Sora',sans-serif;font-size:1.25rem;font-weight:800;line-height:1.35;letter-spacing:-.02em;margin-bottom:.65rem;}
.article-divider{height:2px;background:linear-gradient(to right,var(--teal),transparent);margin:.65rem 0;border-radius:10px;}
.article-body{font-size:.875rem;line-height:1.75;color:var(--text);}
.article-body p{margin-bottom:1rem;}
.article-body h2{font-family:'Sora',sans-serif;font-weight:800;font-size:1rem;margin:1.25rem 0 .5rem;color:var(--text);}
.article-body h3{font-family:'Sora',sans-serif;font-weight:700;font-size:.9rem;margin:1rem 0 .4rem;color:var(--accent);}
.article-body ul{padding-left:1.2rem;margin-bottom:1rem;}
.article-body li{margin-bottom:.4rem;}
.article-body blockquote{border-left:3px solid var(--teal);padding:.6rem 1rem;background:rgba(20,184,166,.05);border-radius:0 10px 10px 0;margin:.85rem 0;font-style:italic;color:var(--muted);}
.article-body strong{color:var(--text);font-weight:700;}
.article-action-bar{display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-top:1rem;}
.word-count-badge{background:rgba(20,184,166,.1);border:1px solid rgba(20,184,166,.2);color:var(--teal);border-radius:8px;padding:.3rem .65rem;font-size:.68rem;font-weight:700;display:inline-flex;align-items:center;gap:.3rem;}

.gen-steps-wrap{display:flex;flex-direction:column;gap:.5rem;margin:.85rem 0;}
.gen-step{display:flex;align-items:center;gap:.65rem;padding:.65rem .8rem;background:var(--card);border:1px solid var(--border);border-radius:11px;transition:all .3s;}
.gen-step.active{border-color:var(--accent);background:rgba(91,123,255,.06);}
.gen-step.done{border-color:var(--green);background:rgba(0,224,138,.05);}
.gs-icon{font-size:1rem;flex-shrink:0;width:24px;text-align:center;}
.gs-text{font-size:.8rem;font-weight:600;color:var(--muted);transition:color .3s;}
.gen-step.active .gs-text{color:var(--text);}
.gen-step.done .gs-text{color:var(--green);}

.suggest-row{display:flex;flex-wrap:wrap;gap:.4rem;margin-bottom:.75rem;}
.suggest-chip{background:var(--card2);border:1px solid var(--border);color:var(--muted);padding:.28rem .7rem;border-radius:50px;font-size:.7rem;font-weight:600;cursor:pointer;transition:all .15s;}
.suggest-chip:active{background:var(--card);color:var(--text);}

.sec-divider{height:1px;background:var(--border);margin:.25rem 1.1rem .75rem;}
</style>
</head>
<body>

<!-- HOME -->
<div class="page active" id="page-home">
  <div class="phead">
    <div style="display:flex;align-items:center;justify-content:space-between;">
      <div>
        <h1 id="helloText">âš¡ Slide Mind</h1>
        <p>Yarating, mashq qiling, ulashing.</p>
      </div>
      <div class="credit-pill" onclick="showPage('credits')">
        <div class="cp-dot"></div>
        <span id="creditCount">3</span> Kredit
      </div>
    </div>
  </div>

  <div style="padding:0 1.1rem 0;">
    <div class="hero-banner" id="heroBanner" onclick="bannerAction()">
      <div class="hb-bg" id="heroBannerBg"></div>
      <div class="hb-noise"></div>
      <div class="hb-circle1"></div>
      <div class="hb-circle2"></div>
      <div class="hb-emoji" id="heroBannerEmoji">âœï¸</div>
      <div class="hb-content">
        <h2 id="bannerTitle">AI Maqola Yozuvchi</h2>
        <p id="bannerDesc">Professional maqolalar yarating. 2 kredit.</p>
        <div class="hb-btn" id="bannerBtn">Hozir boshlash â†’</div>
      </div>
    </div>
    <div class="slider-dots" id="sliderDots"></div>
  </div>

  <div class="section">
    <div class="sec-title">Boshlash uchun</div>
    <div class="action-list">
      <div class="action-card" onclick="showPage('article')">
        <div class="ac-icon" style="background:rgba(20,184,166,.1);color:var(--teal);">âœï¸</div>
        <div class="ac-body"><h3>AI Maqola Yozish <span class="hot-tag">HOT</span></h3><p>Professional maqolalar, bloglar, hisobotlar yarating.</p></div>
        <div class="ac-arr">â€º</div>
      </div>
      <div class="action-card" onclick="showPage('pdf')">
        <div class="ac-icon" style="background:rgba(91,123,255,.1);color:var(--accent);">ğŸ“„</div>
        <div class="ac-body"><h3>PDF yuklash</h3><p>Har qanday faylni testga aylantiring.</p></div>
        <div class="ac-arr">â€º</div>
      </div>
      <div class="action-card" onclick="showPage('ai-test')">
        <div class="ac-icon" style="background:rgba(139,92,246,.1);color:var(--purple);">ğŸ¤–</div>
        <div class="ac-body"><h3>AI Test Yaratish <span class="new-tag">NEW</span></h3><p>Istalgan mavzuda test yarating.</p></div>
        <div class="ac-arr">â€º</div>
      </div>
      <div class="action-card" onclick="showPage('presentation')">
        <div class="ac-icon" style="background:rgba(0,224,138,.08);color:var(--green);">ğŸ–¥</div>
        <div class="ac-body"><h3>AI Prezentatsiya <span class="new-tag">NEW</span></h3><p>Professional prezentatsiyalar yarating.</p></div>
        <div class="ac-arr">â€º</div>
      </div>
      <div class="action-card" onclick="showPage('my-tests')">
        <div class="ac-icon" style="background:rgba(245,158,11,.08);color:var(--amber);">ğŸ“š</div>
        <div class="ac-body"><h3>Testlarim</h3><p>Natijalarni ko'ring va ulashing.</p></div>
        <div class="ac-arr">â€º</div>
      </div>
      <div class="action-card" onclick="showPage('wrongs')">
        <div class="ac-icon" style="background:rgba(244,63,94,.08);color:var(--red);">âŒ</div>
        <div class="ac-body"><h3>Noto'g'ri javoblar</h3><p>Xatolaringizni ko'rib chiqing.</p></div>
        <div class="ac-arr">â€º</div>
      </div>
      <div class="action-card" onclick="showPage('group')">
        <div class="ac-icon" style="background:rgba(168,85,247,.08);color:var(--purple);">ğŸ‘¥</div>
        <div class="ac-body"><h3>Guruh testi</h3><p>Do'stlaringiz bilan real vaqtda o'ynang!</p></div>
        <div class="ac-arr">â€º</div>
      </div>
    </div>
  </div>

  <div class="sec-divider"></div>
  <div class="section">
    <div class="sec-title">O'sish va to'lovlar</div>
    <div class="action-list">
      <div class="action-card" onclick="showPage('premium')" style="background:linear-gradient(135deg,rgba(245,158,11,.06),rgba(239,68,68,.06));border-color:rgba(245,158,11,.15);">
        <div class="ac-icon" style="background:rgba(245,158,11,.1);color:var(--amber);">ğŸ‘‘</div>
        <div class="ac-body"><h3>Premium sotib olish</h3><p>Cheksiz kredit va barcha funksiyalar</p></div>
        <div class="ac-arr" style="color:var(--amber);">â€º</div>
      </div>
      <div class="action-card" onclick="showPage('referral')">
        <div class="ac-icon" style="background:rgba(0,224,138,.08);color:var(--green);">ğŸ</div>
        <div class="ac-body"><h3>Do'st taklif qiling</h3><p>Havolani ulashing va kredit oling</p></div>
        <div class="ac-arr">â€º</div>
      </div>
    </div>
  </div>
  <div style="text-align:center;padding:.6rem 1.1rem .25rem;font-size:.7rem;color:var(--muted);">ğŸ’¡ Sifatli PDF fayllar mukammal savollar beradi.</div>
</div>

<!-- ARTICLE WRITER -->
<div class="page" id="page-article">
  <div class="phead">
    <button class="back-btn" onclick="showPage('home')">â† Orqaga</button>
    <h1>âœï¸ AI Maqola Yozuvchi</h1>
    <p>Professional maqolalar bir daqiqada</p>
  </div>
  <div class="section">
    <div class="wiz-steps" id="artWizSteps">
      <div class="wstep active" id="artws1"></div>
      <div class="wstep" id="artws2"></div>
      <div class="wstep" id="artws3"></div>
    </div>

    <div id="artStep1">
      <div class="form-field">
        <label>ğŸ“ Maqola mavzusi</label>
        <textarea id="artTopic" rows="2" placeholder="Masalan: Sun'iy intellektning kelajagi, Sog'lom turmush tarzi..."></textarea>
      </div>
      <div style="font-size:.68rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;margin-bottom:.4rem;">Tezkor mavzular</div>
      <div class="suggest-row" id="artSuggestions"></div>
      <div style="font-size:.68rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;margin-bottom:.55rem;">ğŸ“‚ Maqola turi</div>
      <div class="article-type-grid" id="articleTypeGrid"></div>
      <button class="btn btn-grad" onclick="artNextStep(2)" style="margin-top:.5rem;">Davom â†’</button>
    </div>

    <div id="artStep2" style="display:none;">
      <div style="font-size:.68rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;margin-bottom:.5rem;">ğŸ­ Yozuv uslubi</div>
      <div class="tone-pills" id="tonePills"></div>
      <div style="font-size:.68rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;margin:.85rem 0 .5rem;">ğŸ“ Maqola uzunligi</div>
      <div class="length-pills" id="lengthPills"></div>
      <div style="font-size:.68rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;margin:.85rem 0 .55rem;">ğŸŒ Til</div>
      <div class="choice-grid" style="grid-template-columns:1fr 1fr 1fr;" id="artLangGrid"></div>
      <div style="font-size:.68rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;margin:.85rem 0 .5rem;">ğŸ”‘ Kalit so'zlar (ixtiyoriy)</div>
      <div class="form-field" style="margin:0;">
        <input type="text" id="artKeywords" placeholder="Masalan: AI, texnologiya, kelajak"/>
      </div>
      <div style="display:flex;gap:.5rem;margin-top:1rem;">
        <button class="btn btn-outline" onclick="artNextStep(1)" style="flex:1;">â† Orqaga</button>
        <button class="btn btn-grad" onclick="artNextStep(3)" style="flex:2;">Davom â†’</button>
      </div>
    </div>

    <div id="artStep3" style="display:none;">
      <div class="card" id="artConfirmCard"></div>
      <div style="font-size:.75rem;color:var(--muted);margin-bottom:.85rem;">âš¡ 2 kredit sarflanadi Â· Taxminan 30 soniya</div>
      <div style="display:flex;gap:.5rem;">
        <button class="btn btn-outline" onclick="artNextStep(2)" style="flex:1;">â† Orqaga</button>
        <button class="btn btn-teal" onclick="startArticleGen()" style="flex:2;">âœï¸ Yozishni boshlash</button>
      </div>
    </div>

    <div id="artGenProgress" style="display:none;">
      <div class="gen-wrap" style="padding-top:1.5rem;">
        <div class="gen-anim">âœï¸</div>
        <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.1rem;margin-bottom:.25rem;">AI maqola yozmoqda...</div>
        <div style="font-size:.75rem;color:var(--muted);">Iltimos kuting, sifatli kontent tayyorlanmoqda</div>
        <div class="pbar-bg"><div class="pbar" id="artPbar" style="width:0%"></div></div>
      </div>
      <div class="gen-steps-wrap" id="artGenSteps"></div>
    </div>
  </div>
</div>

<!-- ARTICLE RESULT -->
<div class="page" id="page-article-result">
  <div style="padding:.75rem 1.1rem .5rem;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);">
    <button class="back-btn" onclick="showPage('article')" style="margin:0;">â† Yangi</button>
    <div style="display:flex;gap:.4rem;">
      <button class="btn btn-outline btn-sm" onclick="copyArticle()">ğŸ“‹ Nusxa</button>
      <button class="btn btn-teal btn-sm" onclick="shareArticle()">ğŸ“¤ Ulash</button>
    </div>
  </div>
  <div class="article-result-wrap" id="articleResultWrap"></div>
</div>

<!-- PDF UPLOAD -->
<div class="page" id="page-pdf">
  <div class="phead">
    <button class="back-btn" onclick="showPage('home')">â† Orqaga</button>
    <h1>ğŸ“„ PDF yuklash</h1>
    <p>Faylingizni testga aylantiring</p>
  </div>
  <div class="section" id="pdfSection">
    <div class="form-field">
      <label>Fayl nomi (ixtiyoriy)</label>
      <input type="text" id="pdfName" placeholder="Masalan: Tarix darslik 5-bob"/>
    </div>
    <div onclick="triggerPdfUpload()" id="uploadZone" style="background:var(--card2);border:2px dashed var(--border);border-radius:18px;padding:2rem 1rem;text-align:center;cursor:pointer;margin-bottom:.85rem;">
      <div style="font-size:2.2rem;margin-bottom:.5rem;">ğŸ“¤</div>
      <div style="font-weight:700;margin-bottom:.25rem;font-size:.9rem;">PDF faylni tanlang</div>
      <div style="font-size:.73rem;color:var(--muted);">yoki bu yerga sudrab tashlang</div>
      <div style="font-size:.68rem;color:var(--muted);margin-top:.4rem;">Maks. 20 MB Â· PDF format</div>
    </div>
    <input type="file" id="pdfInput" accept=".pdf" style="display:none" onchange="handlePdfSelect(this)"/>
    <div id="pdfFileInfo" style="display:none;" class="card">
      <div style="display:flex;align-items:center;gap:.65rem;">
        <div style="font-size:1.8rem;">ğŸ“„</div>
        <div style="flex:1;"><div style="font-weight:700;font-size:.85rem;" id="pdfFileName">file.pdf</div><div style="font-size:.72rem;color:var(--muted);" id="pdfFileSize">0 KB</div></div>
        <button onclick="clearPdf()" style="background:rgba(244,63,94,.1);border:none;color:var(--red);padding:.28rem .6rem;border-radius:50px;font-size:.72rem;font-weight:700;cursor:pointer;">âœ•</button>
      </div>
    </div>
    <div style="margin:.75rem 0;background:rgba(245,158,11,.06);border:1px solid rgba(245,158,11,.18);border-radius:11px;padding:.75rem;font-size:.75rem;">
      <strong>âš¡ 1 kredit sarflanadi</strong> â€” sizda <span id="pdfCreditShow">3</span> ta kredit bor
    </div>
    <button class="btn btn-grad" onclick="uploadPdf()">ğŸš€ Testga aylantirish</button>
  </div>
  <div id="pdfProcessing" style="display:none;" class="section">
    <div class="gen-wrap">
      <div class="gen-anim">âš™ï¸</div>
      <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.1rem;margin-bottom:.3rem;">PDF qayta ishlanmoqda...</div>
      <div class="pbar-bg"><div class="pbar" id="pdfPbar" style="width:0%"></div></div>
      <div style="font-size:.76rem;color:var(--muted);" id="pdfPbarText">Boshlanyapti...</div>
    </div>
  </div>
</div>

<!-- AI TEST -->
<div class="page" id="page-ai-test">
  <div class="phead">
    <button class="back-btn" onclick="showPage('home')">â† Orqaga</button>
    <h1>ğŸ¤– AI Test Yaratish</h1>
  </div>
  <div class="section">
    <div class="wiz-steps" id="aiWizSteps">
      <div class="wstep active" id="aws1"></div>
      <div class="wstep" id="aws2"></div>
      <div class="wstep" id="aws3"></div>
    </div>
    <div id="aiStep1">
      <div class="form-field">
        <label>ğŸ“ Mavzu</label>
        <textarea id="aiTopic" rows="3" placeholder="Masalan: Python dasturlash, Ingliz tili grammatikasi, O'zbekiston tarixi..."></textarea>
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:.4rem;margin-bottom:.85rem;" id="topicSuggestions"></div>
      <button class="btn btn-grad" onclick="aiNextStep(2)">Davom â†’</button>
    </div>
    <div id="aiStep2" style="display:none;">
      <div style="font-size:.68rem;font-weight:700;color:var(--muted);text-transform:uppercase;margin-bottom:.5rem;">ğŸ“Š Savollar soni</div>
      <div class="count-pills" id="aiCountPills"></div>
      <div style="font-size:.68rem;font-weight:700;color:var(--muted);text-transform:uppercase;margin:.75rem 0 .5rem;">ğŸ¯ Qiyinlik</div>
      <div class="choice-grid" style="grid-template-columns:1fr 1fr 1fr;" id="diffGrid">
        <div class="choice-btn sel" onclick="selDiff('easy',this)"><div class="cb-icon">ğŸ˜Š</div><div class="cb-name">Oson</div></div>
        <div class="choice-btn" onclick="selDiff('medium',this)"><div class="cb-icon">ğŸ˜</div><div class="cb-name">O'rta</div></div>
        <div class="choice-btn" onclick="selDiff('hard',this)"><div class="cb-icon">ğŸ”¥</div><div class="cb-name">Qiyin</div></div>
      </div>
      <div style="font-size:.68rem;font-weight:700;color:var(--muted);text-transform:uppercase;margin:.75rem 0 .5rem;">ğŸŒ Til</div>
      <div class="choice-grid" style="grid-template-columns:1fr 1fr 1fr;" id="langGrid">
        <div class="choice-btn sel" onclick="selLang('uz',this)"><div class="cb-icon">ğŸ‡ºğŸ‡¿</div><div class="cb-name">O'zbek</div></div>
        <div class="choice-btn" onclick="selLang('ru',this)"><div class="cb-icon">ğŸ‡·ğŸ‡º</div><div class="cb-name">Rus</div></div>
        <div class="choice-btn" onclick="selLang('en',this)"><div class="cb-icon">ğŸ‡¬ğŸ‡§</div><div class="cb-name">Ingliz</div></div>
      </div>
      <div style="display:flex;gap:.5rem;margin-top:.85rem;">
        <button class="btn btn-outline" onclick="aiNextStep(1)" style="flex:1;">â† Orqaga</button>
        <button class="btn btn-grad" onclick="aiNextStep(3)" style="flex:2;">Davom â†’</button>
      </div>
    </div>
    <div id="aiStep3" style="display:none;">
      <div class="card" id="aiConfirmCard"></div>
      <div style="font-size:.75rem;color:var(--muted);margin-bottom:.85rem;">âš¡ 2 kredit sarflanadi</div>
      <div style="display:flex;gap:.5rem;">
        <button class="btn btn-outline" onclick="aiNextStep(2)" style="flex:1;">â† Orqaga</button>
        <button class="btn btn-grad" onclick="startAiGen()" style="flex:2;">ğŸš€ Yaratish</button>
      </div>
    </div>
    <div id="aiGenProgress" style="display:none;">
      <div class="gen-wrap">
        <div class="gen-anim">ğŸ¤–</div>
        <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.1rem;margin-bottom:.25rem;">AI ishlamoqda...</div>
        <div class="pbar-bg"><div class="pbar" id="aiPbar" style="width:0%"></div></div>
        <div style="font-size:.76rem;color:var(--muted);margin-top:.35rem;" id="aiPbarText">Mavzu tahlil qilinmoqda...</div>
      </div>
    </div>
  </div>
</div>

<!-- QUIZ -->
<div class="page" id="page-quiz" style="padding-bottom:0;">
  <div class="quiz-header">
    <div class="qh-top">
      <div class="qh-counter" id="qCounter">1 / 10</div>
      <div class="qh-timer" id="qTimer">â± 20:00</div>
    </div>
    <div class="qpbar-bg"><div class="qpbar" id="qPbar" style="width:0%"></div></div>
  </div>
  <div class="quiz-body" id="quizBody">
    <div class="q-num" id="qNum">SAVOL 1</div>
    <div class="q-text" id="qText"></div>
    <div class="options" id="qOptions"></div>
  </div>
  <div class="quiz-nav">
    <button onclick="quizPrev()" class="btn btn-outline btn-sm" style="width:auto;">â†</button>
    <div class="qdots" id="qDots"></div>
    <button onclick="quizNext()" class="btn btn-grad btn-sm" id="qNextBtn" style="width:auto;">â†’</button>
  </div>
</div>

<!-- RESULT -->
<div class="page" id="page-result">
  <div class="result-hero" id="resultHero"></div>
  <div class="res-stats" id="resStats"></div>
  <div class="section">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-bottom:.5rem;">
      <button class="btn btn-grad" onclick="retryQuiz()">ğŸ”„ Qayta</button>
      <button class="btn btn-outline" onclick="showPage('home')">ğŸ  Menyu</button>
    </div>
    <button class="btn btn-outline" onclick="showPage('group')">ğŸ“¤ Guruhga ulashish</button>
  </div>
</div>

<!-- MY TESTS -->
<div class="page" id="page-my-tests">
  <div class="phead">
    <button class="back-btn" onclick="showPage('home')">â† Orqaga</button>
    <h1>ğŸ“š Testlarim</h1>
  </div>
  <div class="section" id="myTestsList">
    <div style="text-align:center;padding:2rem;color:var(--muted);font-size:.85rem;">
      Hali test yaratmadingiz.<br/>
      <button class="btn btn-grad" style="margin-top:.85rem;width:auto;padding:.55rem 1.4rem;" onclick="showPage('pdf')">ğŸ“„ PDF yuklash</button>
    </div>
  </div>
</div>

<!-- WRONGS -->
<div class="page" id="page-wrongs">
  <div class="phead">
    <button class="back-btn" onclick="showPage('home')">â† Orqaga</button>
    <h1>âŒ Noto'g'ri javoblar</h1>
  </div>
  <div class="section" id="wrongsList">
    <div style="text-align:center;padding:2rem;color:var(--muted);">Hali noto'g'ri javob yo'q! Zo'r! ğŸ‰</div>
  </div>
</div>

<!-- GROUP TEST -->
<div class="page" id="page-group">
  <div class="phead">
    <button class="back-btn" onclick="showPage('home')">â† Orqaga</button>
    <h1>ğŸ‘¥ Guruh testi</h1>
    <p>Do'stlar bilan real vaqtda raqobat</p>
  </div>
  <div class="section">
    <div class="card" style="background:linear-gradient(135deg,rgba(91,123,255,.08),rgba(139,92,246,.08));border-color:rgba(91,123,255,.18);text-align:center;padding:1.35rem;">
      <div style="font-size:1.8rem;margin-bottom:.4rem;">ğŸ†</div>
      <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1rem;margin-bottom:.25rem;">Guruh Testi</div>
      <div style="font-size:.75rem;color:var(--muted);margin-bottom:.85rem;">Sessiya yarating va do'stlaringizni taklif qiling</div>
      <button class="btn btn-grad" onclick="createSession()">â• Sessiya yaratish</button>
    </div>
    <div style="text-align:center;margin:.75rem 0;font-size:.75rem;color:var(--muted);">yoki</div>
    <div class="form-field">
      <label>ğŸ”‘ Sessiya kodi</label>
      <input type="text" id="sessionCode" placeholder="QUIZ1234" style="text-transform:uppercase;font-family:'JetBrains Mono',monospace;font-weight:700;letter-spacing:.1em;font-size:.95rem;text-align:center;"/>
    </div>
    <button class="btn btn-outline" onclick="joinSession()">ğŸ”— Sessiyaga qo'shilish</button>
  </div>
  <div class="section">
    <div class="sec-title">ğŸ† Liderlar jadvali</div>
    <div id="leaderboard"></div>
  </div>
</div>

<!-- CREDITS -->
<div class="page" id="page-credits">
  <div class="phead">
    <button class="back-btn" onclick="showPage('home')">â† Orqaga</button>
    <h1>âš¡ Kreditlar</h1>
    <div style="display:flex;align-items:baseline;gap:.4rem;margin-top:.25rem;">
      <span style="font-family:'Sora',sans-serif;font-size:1.9rem;font-weight:800;color:var(--amber);" id="creditsNum">3</span>
      <span style="color:var(--muted);font-size:.8rem;">ta kredit mavjud</span>
    </div>
  </div>
  <div class="section">
    <div style="background:var(--card);border-radius:12px;padding:.8rem .9rem;margin-bottom:.85rem;font-size:.78rem;border:1px solid var(--border);">
      <div style="font-weight:700;margin-bottom:.45rem;">Kredit sarfi:</div>
      <div style="display:flex;justify-content:space-between;padding:.28rem 0;border-bottom:1px solid var(--border);">ğŸ“„ PDF yuklash<span style="color:var(--accent);font-weight:700;">1 kredit</span></div>
      <div style="display:flex;justify-content:space-between;padding:.28rem 0;border-bottom:1px solid var(--border);">ğŸ¤– AI test yaratish<span style="color:var(--accent);font-weight:700;">2 kredit</span></div>
      <div style="display:flex;justify-content:space-between;padding:.28rem 0;border-bottom:1px solid var(--border);">âœï¸ AI Maqola yozish<span style="color:var(--teal);font-weight:700;">2 kredit</span></div>
      <div style="display:flex;justify-content:space-between;padding:.28rem 0;">ğŸ–¥ AI Prezentatsiya<span style="color:var(--accent);font-weight:700;">3 kredit</span></div>
    </div>
    <div class="sec-title">Kredit sotib olish</div>
    <div class="pkg-list" id="creditPackages"></div>
    <div style="margin-top:.85rem;"><button class="btn btn-grad" onclick="showPage('premium')">ğŸ‘‘ Premium â€” kredit cheksiz!</button></div>
  </div>
</div>

<!-- PREMIUM -->
<div class="page" id="page-premium">
  <div class="phead">
    <button class="back-btn" onclick="showPage('home')">â† Orqaga</button>
    <h1>ğŸ‘‘ Premium</h1>
    <p>Kreditlar to'g'risida bosh og'rig'ini unuting</p>
  </div>
  <div class="section">
    <div class="plan-cards" id="premiumPlans"></div>
    <div class="card" id="payMethodCard" style="display:none;">
      <div class="card-title">ğŸ’³ To'lov usuli</div>
      <div class="pay-grid">
        <div class="pay-m sel" onclick="selPayMethod('click',this)"><div class="pm-icon">ğŸ¦</div><div class="pm-name">Click.uz</div></div>
        <div class="pay-m" onclick="selPayMethod('payme',this)"><div class="pm-icon">ğŸ’š</div><div class="pm-name">Payme</div></div>
      </div>
      <button class="btn btn-grad" id="payBtn" onclick="processPay()">ğŸ’³ To'lash</button>
    </div>
  </div>
</div>

<!-- REFERRAL -->
<div class="page" id="page-referral">
  <div class="phead">
    <button class="back-btn" onclick="showPage('home')">â† Orqaga</button>
    <h1>ğŸ Do'st taklif qiling</h1>
    <p>Har bir do'stingiz uchun +5 kredit</p>
  </div>
  <div class="section">
    <div class="stat-grid" style="margin-bottom:.85rem;">
      <div class="stat-box"><div class="sv" id="refCount">0</div><div class="sl">Do'stlar</div></div>
      <div class="stat-box"><div class="sv" id="refEarned" style="color:var(--green);">0</div><div class="sl">Kredit topildi</div></div>
    </div>
    <div style="font-weight:700;font-size:.8rem;margin-bottom:.45rem;">ğŸ”— Sizning havolangiz:</div>
    <div class="ref-box" id="refLink" onclick="copyRef()">https://t.me/QuizBotPro?start=REF12345</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:.5rem;">
      <button class="btn btn-grad" onclick="copyRef()">ğŸ“‹ Nusxa olish</button>
      <button class="btn btn-outline" onclick="shareRef()">ğŸ“¤ Ulashish</button>
    </div>
  </div>
</div>

<!-- PROFILE -->
<div class="page" id="page-profile">
  <div class="phead"><h1>ğŸ‘¤ Profil</h1></div>
  <div class="prof-card">
    <div class="prof-av" id="profAvatar">ğŸ˜Š</div>
    <div class="prof-name" id="profName">Foydalanuvchi</div>
    <div class="prof-plan plan-free" id="profPlan">ğŸ Bepul tarif</div>
  </div>
  <div class="section">
    <div class="stat-grid" style="margin-bottom:.75rem;">
      <div class="stat-box"><div class="sv" id="pTests">0</div><div class="sl">Testlar</div></div>
      <div class="stat-box"><div class="sv" id="pCredit">3</div><div class="sl">Kreditlar</div></div>
    </div>
    <div class="action-list">
      <div class="action-card" onclick="showPage('premium')"><div class="ac-icon" style="background:rgba(245,158,11,.08);color:var(--amber);">ğŸ‘‘</div><div class="ac-body"><h3>Premium olish</h3><p>Cheksiz testlar va AI</p></div><div class="ac-arr">â€º</div></div>
      <div class="action-card" onclick="showPage('referral')"><div class="ac-icon" style="background:rgba(0,224,138,.07);color:var(--green);">ğŸ</div><div class="ac-body"><h3>Referral dasturi</h3><p>Do'stlarni taklif qil</p></div><div class="ac-arr">â€º</div></div>
      <div class="action-card" onclick="showPage('credits')"><div class="ac-icon" style="background:rgba(245,158,11,.08);color:var(--amber);">âš¡</div><div class="ac-body"><h3>Kredit sotib olish</h3><p>PDF va AI uchun</p></div><div class="ac-arr">â€º</div></div>
    </div>
  </div>
</div>

<!-- PRESENTATION -->
<div class="page" id="page-presentation">
  <div class="phead">
    <button class="back-btn" onclick="showPage('home')">â† Orqaga</button>
    <h1>ğŸ–¥ AI Prezentatsiya</h1>
    <p>Professional slaydlar â€” 3 kredit</p>
  </div>
  <div class="section" id="presSection">
    <div class="form-field"><label>ğŸ“ Mavzu</label><input type="text" id="presTitle" placeholder="Masalan: Startup pitch, Biznes taklif..."/></div>
    <div class="form-field"><label>ğŸ“„ Slaydlar soni</label><div class="count-pills" id="presCountPills"></div></div>
    <div class="form-field"><label>ğŸ¨ Dizayn uslubi</label><div class="choice-grid" id="presStyles"></div></div>
    <div style="margin-bottom:.85rem;font-size:.75rem;color:var(--muted);">âš¡ 3 kredit sarflanadi</div>
    <button class="btn btn-grad" onclick="startPresGen()">ğŸš€ Yaratish</button>
  </div>
  <div id="presGenProgress" style="display:none;" class="section">
    <div class="gen-wrap">
      <div class="gen-anim">ğŸ¨</div>
      <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.1rem;">Prezentatsiya yaratilmoqda...</div>
      <div class="pbar-bg"><div class="pbar" id="presPbar" style="width:0%"></div></div>
      <div style="font-size:.75rem;color:var(--muted);margin-top:.35rem;" id="presPbarText">AI mavzuni tahlil qilmoqda...</div>
    </div>
  </div>
</div>

<div class="toast-wrap" id="toastWrap"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TELEGRAM WEBAPP INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const tg = window.Telegram?.WebApp;
if (tg) {
  tg.ready();
  tg.expand();
  tg.enableClosingConfirmation();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GLOBAL STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const S = {
  credits: 3,
  isPremium: false,
  plan: null,
  name: tg?.initDataUnsafe?.user?.first_name || 'Foydalanuvchi',
  tests: [],
  articles: [],
  quiz: { questions:[], current:0, answers:[], score:0, testName:'' },
  // FIX: barcha parametrlar to'g'ri nested ob'ekt ichida
  aiOpts:  { count:10, diff:'easy',   lang:'uz' },
  artOpts: { type:'blog', tone:'Rasmiy', length:'medium', lang:'uz', keywords:'' },
  payMethod: 'click',
  selPlanId: null,
  presOpts: { slides:10, style:'business' },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BANNERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BANNERS = [
  {title:'AI Maqola Yozuvchi', desc:'Professional maqolalar yarating. 2 kredit.', emoji:'âœï¸', btn:'Hozir boshlash â†’', action:'article', bg:'linear-gradient(135deg,#0a3a3a,#0d6060,#0a9a7a)'},
  {title:'Guruh testi!', desc:"Sessiya yarating yoki kod bilan qo'shiling.", emoji:'ğŸ‘¥', btn:"Sessiyaga qo'shilish", action:'group', bg:'linear-gradient(135deg,#1a1a8e,#3a1a8e,#6e1a8e)'},
  {title:'PDF â†’ Test!', desc:'Darsligingizni testga aylantiring. 1 kredit.', emoji:'ğŸ“„', btn:'PDF yuklash', action:'pdf', bg:'linear-gradient(135deg,#0a2a60,#1a4a96,#0a60c0)'},
  {title:'Premium â€” kredit cheksiz!', desc:"Barcha funksiyalar to'liq ochiladi.", emoji:'ğŸ‘‘', btn:'Premium olish', action:'premium', bg:'linear-gradient(135deg,#3a2000,#705000,#b07800)'},
];
let bannerIdx = 0, bannerTimer = null;

function initBanners() {
  const dots = document.getElementById('sliderDots');
  dots.innerHTML = BANNERS.map((_,i) =>
    `<div class="sdot${i===0?' active':''}" onclick="event.stopPropagation();showBanner(${i})"></div>`
  ).join('');
  showBanner(0);
  bannerTimer = setInterval(() => showBanner((bannerIdx + 1) % BANNERS.length), 4200);
}

function showBanner(i) {
  bannerIdx = i;
  const b = BANNERS[i];
  document.getElementById('bannerTitle').textContent    = b.title;
  document.getElementById('bannerDesc').textContent     = b.desc;
  document.getElementById('heroBannerEmoji').textContent= b.emoji;
  document.getElementById('bannerBtn').textContent      = b.btn;
  document.getElementById('heroBannerBg').style.background = b.bg;
  document.querySelectorAll('.sdot').forEach((d,j) => d.classList.toggle('active', j===i));
}

function bannerAction() { showPage(BANNERS[bannerIdx].action); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const NAV = [
  {page:'home',     icon:'ğŸ ', label:'Bosh'},
  {page:'article',  icon:'âœï¸', label:'Maqola'},
  {page:'my-tests', icon:'ğŸ“š', label:'Testlar'},
  {page:'profile',  icon:'ğŸ‘¤', label:'Profil'},
  {page:'credits',  icon:'âš¡', label:'Kredit'},
];

function buildNav() {
  const nav = document.createElement('div');
  nav.className = 'bnav';
  nav.innerHTML = NAV.map(n => `
    <div class="bni${n.page==='home'?' active':''}" data-page="${n.page}" onclick="showPage('${n.page}')">
      <div class="bni-icon">${n.icon}</div>
      <div class="bni-label">${n.label}</div>
    </div>`).join('');
  document.body.appendChild(nav);
}

function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  const pg = document.getElementById('page-' + name);
  if (pg) pg.classList.add('active');
  document.querySelectorAll('.bni').forEach(n => n.classList.toggle('active', n.dataset.page === name));
  window.scrollTo(0,0);
  if (pg) pg.scrollTo(0,0);
  if (name === 'profile') updateProfile();
  if (name === 'credits') updateCredits();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ARTICLE WRITER â€” DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ART_TYPES = [
  {id:'blog',     icon:'ğŸ“', name:'Blog maqola',    desc:'Informatsion'},
  {id:'news',     icon:'ğŸ“°', name:'Yangilik',        desc:'Xabar uslubi'},
  {id:'seo',      icon:'ğŸ”', name:'SEO maqola',      desc:'Qidiruv uchun'},
  {id:'academic', icon:'ğŸ“', name:'Akademik',        desc:'Ilmiy uslub'},
  {id:'review',   icon:'â­', name:'Sharh',           desc:'Mahsulot/xizmat'},
  {id:'social',   icon:'ğŸ“±', name:'Ijtimoiy tarmoq', desc:'Post uchun'},
];
const TONES   = ['Rasmiy','Norasmiy','Ilmiy','Kreativ','Sodda','Ishontiruvchi'];
const LENGTHS = [
  {id:'short',  label:'Qisqa', desc:"300-500 so'z"},
  {id:'medium', label:"O'rta", desc:"600-900 so'z"},
  {id:'long',   label:'Uzun',  desc:"1000-1500 so'z"},
];
const ART_SUGGESTIONS = [
  "Sun'iy intellekt","Sog'lom turmush","O'zbekiston iqtisodiyoti",
  "Startap biznes","Ta'lim tizimi","Ekologiya","Texnologiya","Sport va salomatlik"
];
const ART_GEN_STEPS = [
  {id:'analyze',    icon:'ğŸ”', text:"Mavzu va kalit so'zlar tahlil qilinmoqda..."},
  {id:'structure',  icon:'ğŸ“', text:'Maqola strukturasi yaratilmoqda...'},
  {id:'intro',      icon:'âœï¸', text:'Kirish qismi yozilmoqda...'},
  {id:'body',       icon:'ğŸ“–', text:"Asosiy qism va bo'limlar yozilmoqda..."},
  {id:'conclusion', icon:'ğŸ', text:'Xulosa va QO tayyorlanmoqda...'},
  {id:'polish',     icon:'âœ¨', text:'Matn sayqallanmoqda va tekshirilmoqda...'},
];

// â”€â”€â”€ Article UI Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderArticleUI() {
  // Types
  document.getElementById('articleTypeGrid').innerHTML = ART_TYPES.map(t =>
    `<div class="at-card${t.id==='blog'?' sel':''}" onclick="selArtType('${t.id}',this)">
      <div class="at-icon">${t.icon}</div>
      <div class="at-name">${t.name}</div>
      <div class="at-desc">${t.desc}</div>
    </div>`
  ).join('');
  // Suggestions
  document.getElementById('artSuggestions').innerHTML = ART_SUGGESTIONS.map(s =>
    `<div class="suggest-chip" onclick="setArtTopic('${s}')">${s}</div>`
  ).join('');
  // Tones
  document.getElementById('tonePills').innerHTML = TONES.map((t,i) =>
    `<div class="tone-pill${i===0?' sel':''}" onclick="selTone('${t}',this)">${t}</div>`
  ).join('');
  // Lengths
  document.getElementById('lengthPills').innerHTML = LENGTHS.map(l =>
    `<div class="lpill${l.id==='medium'?' sel':''}" onclick="selLength('${l.id}',this)">${l.label} <span style="color:var(--muted);font-size:.65rem;">${l.desc}</span></div>`
  ).join('');
  // Lang
  document.getElementById('artLangGrid').innerHTML = `
    <div class="choice-btn sel" onclick="selArtLang('uz',this)"><div class="cb-icon">ğŸ‡ºğŸ‡¿</div><div class="cb-name">O'zbek</div></div>
    <div class="choice-btn" onclick="selArtLang('ru',this)"><div class="cb-icon">ğŸ‡·ğŸ‡º</div><div class="cb-name">Rus</div></div>
    <div class="choice-btn" onclick="selArtLang('en',this)"><div class="cb-icon">ğŸ‡¬ğŸ‡§</div><div class="cb-name">Ingliz</div></div>`;
}

function selArtType(id, el) {
  S.artOpts.type = id;
  document.getElementById('articleTypeGrid').querySelectorAll('.at-card').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
}
function setArtTopic(t) { document.getElementById('artTopic').value = t; }
function selTone(t, el) {
  S.artOpts.tone = t;
  document.getElementById('tonePills').querySelectorAll('.tone-pill').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
}
function selLength(l, el) {
  S.artOpts.length = l;
  document.getElementById('lengthPills').querySelectorAll('.lpill').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
}
function selArtLang(l, el) {
  S.artOpts.lang = l;
  document.getElementById('artLangGrid').querySelectorAll('.choice-btn').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
}

function artNextStep(n) {
  if (n===2 && !document.getElementById('artTopic').value.trim()) {
    toast('âš ï¸ Mavzuni kiriting!'); return;
  }
  [1,2,3].forEach(i => {
    document.getElementById('artStep'+i).style.display = i===n ? 'block' : 'none';
    const ws = document.getElementById('artws'+i);
    ws.className = 'wstep' + (i<n ? ' done' : i===n ? ' active' : '');
  });
  if (n===3) renderArtConfirm();
}

function renderArtConfirm() {
  const typeObj = ART_TYPES.find(t => t.id === S.artOpts.type);
  const lenObj  = LENGTHS.find(l => l.id === S.artOpts.length);
  const langMap = {uz:"ğŸ‡ºğŸ‡¿ O'zbek", ru:'ğŸ‡·ğŸ‡º Rus', en:'ğŸ‡¬ğŸ‡§ Ingliz'};
  document.getElementById('artConfirmCard').innerHTML = `
    <div class="card-title">âœ… Tasdiqlash</div>
    <div style="display:flex;flex-direction:column;gap:.38rem;font-size:.82rem;">
      <div>ğŸ“ Mavzu: <strong>${document.getElementById('artTopic').value}</strong></div>
      <div>ğŸ“‚ Turi: <strong>${typeObj.icon} ${typeObj.name}</strong></div>
      <div>ğŸ­ Uslub: <strong>${S.artOpts.tone}</strong></div>
      <div>ğŸ“ Uzunlik: <strong>${lenObj.label} (${lenObj.desc})</strong></div>
      <div>ğŸŒ Til: <strong>${langMap[S.artOpts.lang]}</strong></div>
      ${S.artOpts.keywords ? `<div>ğŸ”‘ Kalit so'zlar: <strong>${S.artOpts.keywords}</strong></div>` : ''}
    </div>`;
}

// FIX: startArticleGen â€” to'g'ri async funksiya, mahalliy animatsiya bilan
async function startArticleGen() {
  if (S.credits < 2 && !S.isPremium) {
    toast('âš¡ 2 kredit kerak!'); showPage('credits'); return;
  }
  const topic = document.getElementById('artTopic').value.trim();
  if (!topic) { toast('âš ï¸ Mavzuni kiriting!'); return; }
  S.artOpts.keywords = document.getElementById('artKeywords').value.trim();

  // Progress ko'rsatish
  [1,2,3].forEach(i => { document.getElementById('artStep'+i).style.display = 'none'; });
  document.getElementById('artGenProgress').style.display = 'block';

  // Gen steps HTML
  document.getElementById('artGenSteps').innerHTML = ART_GEN_STEPS.map(s =>
    `<div class="gen-step" id="gs_${s.id}">
      <div class="gs-icon">â³</div>
      <div class="gs-text">${s.text}</div>
    </div>`
  ).join('');

  const pcts = [15, 30, 50, 70, 88, 100];
  for (let i = 0; i < ART_GEN_STEPS.length; i++) {
    await sleep(800 + Math.random() * 400);
    if (i > 0) {
      const prev = document.getElementById('gs_' + ART_GEN_STEPS[i-1].id);
      if (prev) { prev.className='gen-step done'; prev.querySelector('.gs-icon').textContent='âœ…'; }
    }
    const cur = document.getElementById('gs_' + ART_GEN_STEPS[i].id);
    if (cur) { cur.className='gen-step active'; cur.querySelector('.gs-icon').textContent=ART_GEN_STEPS[i].icon; }
    document.getElementById('artPbar').style.width = pcts[i] + '%';
  }
  await sleep(600);
  const last = document.getElementById('gs_' + ART_GEN_STEPS[ART_GEN_STEPS.length-1].id);
  if (last) { last.className='gen-step done'; last.querySelector('.gs-icon').textContent='âœ…'; }

  // Kredit ayirish
  if (!S.isPremium) { S.credits -= 2; updateCreditsDisplay(); }

  await sleep(300);
  showArticleResult(topic);

  // Wizardni reset qilish
  setTimeout(() => {
    document.getElementById('artGenProgress').style.display = 'none';
    document.getElementById('artStep1').style.display = 'block';
    [1,2,3].forEach(i => {
      document.getElementById('artws'+i).className = 'wstep' + (i===1 ? ' active' : '');
    });
    document.getElementById('artTopic').value    = '';
    document.getElementById('artKeywords').value = '';
  }, 500);
}

// â”€â”€â”€ Article content generators â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generateArticleHTML(topic, type, tone, length, keywords) {
  const typeObj = ART_TYPES.find(t => t.id === type) || ART_TYPES[0];
  const wordCounts = {short:'~420', medium:'~750', long:'~1200'};
  const readTimes  = {short:'2',    medium:'4',    long:'6'};
  const generators = {
    blog:     () => generateBlogArticle(topic, tone, length, keywords),
    news:     () => generateNewsArticle(topic, tone, length),
    seo:      () => generateSEOArticle(topic, length, keywords),
    academic: () => generateAcademicArticle(topic, length),
    review:   () => generateReviewArticle(topic, length),
    social:   () => generateSocialArticle(topic),
  };
  const html = (generators[type] || generators['blog'])();
  return { html, wordCount: wordCounts[length], readTime: readTimes[length], typeObj };
}

function generateBlogArticle(topic, tone, length, kw) {
  const kwSection = kw ? `<p>Bu maqolada <strong>${kw}</strong> kabi muhim tushunchalar atroflicha yoritiladi.</p>` : '';
  return `
<h2>Kirish</h2>
<p><strong>${topic}</strong> â€” bugungi kunda juda dolzarb mavzulardan biri. Texnologiyalar rivojlanishi va jamiyatimiz o'zgarishi bilan birga, bu soha ham yangi imkoniyatlar va qiziqarli savollarni yuzaga keltirmoqda.</p>
${kwSection}
<blockquote>"Bilim â€” bu kuch, ammo uni qo'llash â€” bu donolik."</blockquote>
<h2>Asosiy fikrlar</h2>
<p>${topic} haqida to'liq tushunchaga ega bo'lish uchun bir nechta muhim jihatlarni ko'rib chiqish kerak.</p>
<h3>1. Tarixiy asos va rivojlanish</h3>
<p>Har qanday soha singari, ${topic} ham o'z rivojlanish yo'lidan o'tgan. Dastlabki bosqichlarda oddiy ko'ringan masalalar zamonaviy tadqiqotlar orqali yangi ma'no kasb etgan.</p>
<ul>
  <li>Boshlang'ich rivojlanish bosqichi va asosiy kashfiyotlar</li>
  <li>Zamonaviy tendensiyalar va innovatsiyalar</li>
  <li>Kelajakdagi istiqbollar va imkoniyatlar</li>
</ul>
<h3>2. Amaliy qo'llanish</h3>
<p>${topic} sohasidagi bilimlar hayotning turli sohalarida qo'llaniladi. Biznes, ta'lim, sog'liqni saqlash va texnologiya sektorlarida bu bilimlar tobora muhim ahamiyat kasb etmoqda.</p>
<h3>3. Kelajak imkoniyatlari</h3>
<p>Ekspertlarning fikricha, ${topic} keyingi 5-10 yil ichida yanada kengayib, yangi imkoniyatlar yaratadi.</p>
<h2>Muhim maslahatlar</h2>
<ul>
  <li><strong>Muntazam o'qing</strong> â€” soha yangiliklar va maqolalarni kuzatib boring</li>
  <li><strong>Amaliyot qiling</strong> â€” bilimlarni darhol hayotga tatbiq eting</li>
  <li><strong>Mutaxassislar bilan bog'laning</strong> â€” tajribali odamlar bilan muloqot qiling</li>
</ul>
<h2>Xulosa</h2>
<p>${topic} â€” keng qamrovli tafakkur tizimi. Ushbu maqola sizga yangi istiqbollar ochishda yordam beradi degan umiddamiz!</p>`;
}

function generateNewsArticle(topic) {
  return `
<h2>Asosiy voqea</h2>
<p><strong>${topic}</strong> bo'yicha so'nggi ma'lumotlarga ko'ra, ushbu sohadagi muhim o'zgarishlar kuzatilmoqda. Mutaxassislar bu o'zgarishlar keng jamoatchilik uchun ahamiyatli ekanini ta'kidlamoqda.</p>
<blockquote>"Bu sohadagi yangiliklar nafaqat mahalliy, balki xalqaro miqyosda ham muhim o'zgarishlarga sabab bo'lishi mumkin."</blockquote>
<h2>Tafsilotlar</h2>
<p>Manbalar ma'lumotlariga ko'ra, ${topic} bo'yicha muhim qarorlar qabul qilingan. Ushbu qarorlar amalga oshirilishi bilan bog'liq tadbirlar yaqin vaqtda boshlangani ma'lum qilindi.</p>
<h3>Mutaxassislar fikri</h3>
<p>Soha ekspertlari bu voqeani ijobiy holat sifatida baholaydi. Ularning ta'kidlashicha, ${topic} sohasidagi bu rivojlanish uzoq kutilgan edi.</p>
<h2>Xulosa</h2>
<p>${topic} mavzusidagi so'nggi voqealar soha rivojiga sezilarli ta'sir ko'rsatadi deb kutilmoqda.</p>`;
}

function generateSEOArticle(topic, length, keywords) {
  const kw = keywords || topic;
  return `
<h2>${topic} nima va nima uchun muhim?</h2>
<p>Agar siz <strong>${topic}</strong> haqida izlayotgan bo'lsangiz, to'g'ri joyga keldingiz. Bu qo'llanma sizga <strong>${kw}</strong> haqida to'liq ma'lumot beradi.</p>
<h2>${topic} bilan qanday boshlash kerak?</h2>
<ul>
  <li><strong>1-qadam:</strong> Asosiy tushunchalarni o'rganing</li>
  <li><strong>2-qadam:</strong> Amaliy mashqlar bilan bilimni mustahkamlang</li>
  <li><strong>3-qadam:</strong> Murakkab mavzularga o'ting</li>
</ul>
<h2>Tez-tez beriladigan savollar</h2>
<h3>${topic} qancha vaqt talab etadi?</h3>
<p>Boshlang'ich bilimni olish uchun o'rtacha 2-4 hafta yetarli.</p>
<h3>Muvaffaqiyat sirri nima?</h3>
<p>Muntazamlik va sabr. <strong>${kw}</strong> sohasida yaxshi natijaga erishganlar bir narsaga urg'u beradi: har kuni mashq qilish.</p>
<h2>Xulosa</h2>
<p><strong>${topic}</strong> â€” investitsiya qilingan vaqt ko'p martalab qaytadigan soha. Bugun birinchi qadamni qo'ying!</p>`;
}

function generateAcademicArticle(topic) {
  return `
<h2>Kirish (Introduction)</h2>
<p>Mazkur maqola <strong>${topic}</strong> mavzusini ilmiy-nazariy nuqtai nazardan tahlil qilishga bag'ishlangan. So'nggi tadqiqotlar ko'rsatishicha, bu soha ilmiy hamjamiyat e'tiborining markazida turibdi.</p>
<blockquote>"Ilm-fan to'xtamaydi, chunki hayot ham to'xtamaydi." â€” L. Paster</blockquote>
<h2>Adabiyotlar sharhi</h2>
<p>${topic} sohasidagi ilmiy tadqiqotlar XX asrning o'rtalaridan jadal rivojlana boshladi. Nazariy asoslar uch yo'nalishda shakllangan:</p>
<ul>
  <li>Klassik nazariyalar va ularning zamonaviy talqini</li>
  <li>Empirik tadqiqotlar va statistik tahlillar</li>
  <li>Amaliy tadqiqotlar va case study'lar</li>
</ul>
<h2>Metodologiya</h2>
<p>Tadqiqotda kompleks metodologik yondashuv qo'llanilib, sifat va miqdoriy tahlil usullari birgalikda ishlatildi.</p>
<h2>Natijalar va muhokama</h2>
<p>Olingan natijalar ${topic} sohasidagi mavjud nazariy ko'rsatmalarga to'liq mos keladi.</p>
<h2>Xulosa</h2>
<p>${topic} bo'yicha o'tkazilgan ushbu tadqiqot muhim natijalarni berdi. Kelajakdagi tadqiqotlar uchun bir nechta ilmiy savollar ochiq qolmoqda.</p>`;
}

function generateReviewArticle(topic) {
  return `
<h2>Umumiy taassurot</h2>
<p><strong>${topic}</strong> â€” bu sohada juda ko'p variantlar mavjud, ammo biz atroflicha sinab ko'rdik va eng muhim tomonlarini tahlil qildik.</p>
<h2>Ijobiy tomonlari âœ…</h2>
<ul>
  <li><strong>Sifat:</strong> Kutilganidan yuqori chiqdi</li>
  <li><strong>Foydalanish qulayligi:</strong> Boshlang'ichlar uchun ham tushunarli</li>
  <li><strong>Qiymat-narx nisbati:</strong> Berilgan narxga ko'ra juda foydali</li>
</ul>
<h2>Kamchiliklari âŒ</h2>
<ul>
  <li>Ba'zan javob kutish vaqti biroz uzun bo'ladi</li>
  <li>Ilg'or foydalanuvchilar uchun ba'zi cheklovlar mavjud</li>
</ul>
<blockquote>"${topic} bilan bir oylik tajribamdan keyin aytishim mumkinki â€” sohaning eng yaxshi variantlaridan biri."</blockquote>
<h2>Yakuniy baho: â­â­â­â­ (4/5)</h2>
<p>${topic} umuman olganda yaxshi taassurot qoldirdi. Kichik kamchiliklariga qaramay, bu sohada etakchi o'rinni egallashga barcha asoslar mavjud.</p>`;
}

function generateSocialArticle(topic) {
  return `
<h2>ğŸ”¥ Asosiy xabar</h2>
<p><strong>${topic}</strong> haqida ko'plar bilmagan 5 ta muhim fakt! Bularni bilganingizdan so'ng fikringiz butunlay o'zgaradi ğŸ‘‡</p>
<h2>1ï¸âƒ£ Birinchi fakt</h2>
<p>${topic} aslida biz o'ylagandek emas. Ko'pchilik noto'g'ri tushunchaga ega, lekin haqiqat ancha qiziqarli...</p>
<h2>2ï¸âƒ£ Ikkinchi fakt</h2>
<p>Tadqiqotlar shuni ko'rsatadiki, ${topic} bilan shug'ullanuvchi odamlar o'rtacha 30% ko'proq muvaffaqiyatga erishar ekan!</p>
<h2>3ï¸âƒ£ Amaliy maslahat</h2>
<p>Bugun siz ham boshlay olasiz. Kerak bo'lgan narsa â€” istak va birinchi qadam! âœ…</p>
<blockquote>ğŸ’¬ "Eng yaxshi vaqt 20 yil oldin edi. Ikkinchi eng yaxshi vaqt â€” hozir!"</blockquote>
<h2>ğŸ“£ Xulosa</h2>
<p>${topic} bo'yicha biror savolingiz bormi? Izohda yozing! ğŸ‘‡<br>
#${topic.replace(/\s+/g,'_')} #bilim #rivojlanish #motivatsiya</p>`;
}

function showArticleResult(topic) {
  const {type, tone, length, lang} = S.artOpts;
  const {html, wordCount, readTime, typeObj} = generateArticleHTML(topic, type, tone, length, S.artOpts.keywords);
  const langMap = {uz:"ğŸ‡ºğŸ‡¿ O'zbek", ru:'ğŸ‡·ğŸ‡º Rus', en:'ğŸ‡¬ğŸ‡§ Ingliz'};
  S.articles.push({topic, type, tone, length, html, date: new Date().toLocaleDateString()});

  document.getElementById('articleResultWrap').innerHTML = `
    <div class="article-meta">
      <span>${typeObj.icon} ${typeObj.name}</span>
      <span>ğŸ­ ${tone}</span>
      <span>${langMap[lang] || lang}</span>
      <span>â± ${readTime} daqiqa o'qish</span>
    </div>
    <div class="article-title">${topic}</div>
    <div style="display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem;">
      <div class="word-count-badge">ğŸ“ ${wordCount} so'z</div>
      <div style="font-size:.7rem;color:var(--muted);">${new Date().toLocaleDateString()}</div>
    </div>
    <div class="article-divider"></div>
    <div class="article-body" id="articleBody">${html}</div>
    <div class="article-action-bar">
      <button class="btn btn-teal btn-sm" onclick="copyArticle()" style="width:100%;">ğŸ“‹ Nusxa olish</button>
      <button class="btn btn-outline btn-sm" onclick="shareArticle()" style="width:100%;">ğŸ“¤ Ulashish</button>
    </div>
    <div style="height:.5rem;"></div>`;

  showPage('article-result');
  toast('âœ… Maqola tayyor! ' + wordCount + " so'z");
  if (tg) tg.HapticFeedback?.notificationOccurred('success');
}

function copyArticle() {
  const body = document.getElementById('articleBody');
  if (body) {
    const text = body.innerText || body.textContent;
    navigator.clipboard?.writeText(text).then(() => toast('ğŸ“‹ Maqola nusxa olindi!'));
  }
  if (tg) tg.HapticFeedback?.impactOccurred('light');
}

function shareArticle() {
  if (tg) {
    const body = document.getElementById('articleBody');
    const text = "âœï¸ AI yozgan maqolam:\n\n" + (body?.innerText||'').substring(0,200) + "...\n\n@QuizBotPro orqali yaratildi";
    tg.switchInlineQuery(text, ['users','groups']);
  } else {
    toast('ğŸ“¤ Telegram da oching!');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AI TEST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TOPICS = ['Python','Matematika','Ingliz tili','Tarix','Biologiya','Fizika','Kimyo','IT'];

function renderTopicSugs() {
  document.getElementById('topicSuggestions').innerHTML = TOPICS.map(t =>
    `<button onclick="setTopic('${t}')" style="background:var(--card2);border:1px solid var(--border);color:var(--text);padding:.28rem .75rem;border-radius:50px;font-weight:600;font-size:.72rem;cursor:pointer;">${t}</button>`
  ).join('');
}
function setTopic(t) { document.getElementById('aiTopic').value = t; }

const AI_COUNTS = [5, 10, 15, 20, 25, 30];
function renderAiCountPills() {
  document.getElementById('aiCountPills').innerHTML = AI_COUNTS.map(n =>
    `<div class="cpill${n===10?' sel':''}" onclick="selAiCount(${n},this)">${n}</div>`
  ).join('');
}
// FIX: S.aiOpts.count (eski kod S.aiCount deb yozgan edi)
function selAiCount(n, el) {
  S.aiOpts.count = n;
  document.querySelectorAll('#aiCountPills .cpill').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
}
// FIX: S.aiOpts.diff (eski kod S.aiDiff deb yozgan edi)
function selDiff(d, el) {
  S.aiOpts.diff = d;
  document.getElementById('diffGrid').querySelectorAll('.choice-btn').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
}
// FIX: S.aiOpts.lang (eski kod S.aiLang deb yozgan edi)
function selLang(l, el) {
  S.aiOpts.lang = l;
  document.getElementById('langGrid').querySelectorAll('.choice-btn').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
}

function aiNextStep(n) {
  if (n===2 && !document.getElementById('aiTopic').value.trim()) {
    toast('âš ï¸ Mavzuni kiriting!'); return;
  }
  [1,2,3].forEach(i => {
    document.getElementById('aiStep'+i).style.display = i===n ? 'block' : 'none';
    document.getElementById('aws'+i).className = 'wstep' + (i<n ? ' done' : i===n ? ' active' : '');
  });
  if (n===3) renderAiConfirm();
}

function renderAiConfirm() {
  const d = {easy:'ğŸ˜Š Oson', medium:"ğŸ˜ O'rta", hard:'ğŸ”¥ Qiyin'};
  const l = {uz:"ğŸ‡ºğŸ‡¿ O'zbek", ru:'ğŸ‡·ğŸ‡º Rus', en:'ğŸ‡¬ğŸ‡§ Ingliz'};
  document.getElementById('aiConfirmCard').innerHTML = `
    <div class="card-title">âœ… Tasdiqlash</div>
    <div style="display:flex;flex-direction:column;gap:.35rem;font-size:.82rem;">
      <div>ğŸ“ Mavzu: <strong>${document.getElementById('aiTopic').value}</strong></div>
      <div>ğŸ“Š Savollar: <strong>${S.aiOpts.count} ta</strong></div>
      <div>ğŸ¯ Qiyinlik: <strong>${d[S.aiOpts.diff]}</strong></div>
      <div>ğŸŒ Til: <strong>${l[S.aiOpts.lang]}</strong></div>
    </div>`;
}

// FIX: startAiGen â€” to'g'ri property nomlar, tg.close() olib tashlandi
async function startAiGen() {
  if (S.credits < 2 && !S.isPremium) {
    toast('âš¡ 2 kredit kerak!'); showPage('credits'); return;
  }
  const topic = document.getElementById('aiTopic').value.trim();
  if (!topic) { toast('âš ï¸ Mavzuni kiriting!'); return; }

  [1,2,3].forEach(i => { document.getElementById('aiStep'+i).style.display = 'none'; });
  document.getElementById('aiGenProgress').style.display = 'block';

  const steps = [
    {t:'Mavzu tahlil qilinmoqda...', p:20},
    {t:'Savollar tuzilmoqda...', p:45},
    {t:'Javoblar tekshirilmoqda...', p:70},
    {t:'Test sayqallanmoqda...', p:90},
    {t:'Tayyor!', p:100},
  ];
  for (const s of steps) {
    await sleep(700 + Math.random()*400);
    document.getElementById('aiPbar').style.width    = s.p + '%';
    document.getElementById('aiPbarText').textContent = s.t;
  }

  // Botga ma'lumot yuborish (agar Telegram ichida)
  if (tg?.sendData) {
    const payload = JSON.stringify({
      action: 'gen_ai_quiz',
      topic:  topic,
      count:  S.aiOpts.count,   // FIX: S.aiOpts.count
      diff:   S.aiOpts.diff,    // FIX: S.aiOpts.diff
      lang:   S.aiOpts.lang,    // FIX: S.aiOpts.lang
    });
    tg.sendData(payload);
  } else {
    // Brauzerda test uchun demo quiz ko'rsatish
    if (!S.isPremium) { S.credits -= 2; updateCreditsDisplay(); }
    startDemoQuiz(topic);
  }

  // Wizardni reset
  setTimeout(() => {
    document.getElementById('aiGenProgress').style.display = 'none';
    document.getElementById('aiStep1').style.display = 'block';
    [1,2,3].forEach(i => {
      document.getElementById('aws'+i).className = 'wstep' + (i===1 ? ' active' : '');
    });
    document.getElementById('aiTopic').value = '';
  }, 500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PDF
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function triggerPdfUpload() { document.getElementById('pdfInput').click(); }

function handlePdfSelect(input) {
  const f = input.files[0]; if (!f) return;
  if (!f.name.toLowerCase().endsWith('.pdf')) { toast('âŒ PDF fayl yuklang!'); return; }
  document.getElementById('pdfFileInfo').style.display = 'block';
  document.getElementById('pdfFileName').textContent   = f.name;
  document.getElementById('pdfFileSize').textContent   = (f.size / 1024).toFixed(0) + ' KB';
}

function clearPdf() {
  document.getElementById('pdfInput').value = '';
  document.getElementById('pdfFileInfo').style.display = 'none';
}

async function uploadPdf() {
  if (!document.getElementById('pdfInput').files[0]) {
    toast('âš ï¸ PDF faylni tanlang!'); return;
  }
  if (S.credits < 1 && !S.isPremium) {
    toast('âš¡ Kredit yetarli emas!'); showPage('credits'); return;
  }
  document.getElementById('pdfSection').style.display     = 'none';
  document.getElementById('pdfProcessing').style.display  = 'block';

  const steps = [
    {t:"ğŸ” Matn o'qilmoqda...", p:25},
    {t:'ğŸ“ Savollar generatsiya...', p:55},
    {t:'ğŸ§  AI tekshirmoqda...', p:85},
    {t:'âœ… Test tayyor!', p:100},
  ];
  for (const s of steps) {
    await sleep(1000);
    document.getElementById('pdfPbar').style.width    = s.p + '%';
    document.getElementById('pdfPbarText').textContent= s.t;
  }
  await sleep(300);
  if (!S.isPremium) { S.credits--; updateCreditsDisplay(); }

  const name = document.getElementById('pdfName').value ||
               document.getElementById('pdfFileName').textContent.replace('.pdf','');
  S.tests.push({id:'test_'+Date.now(), name, source:'pdf', count:10, created:new Date().toLocaleDateString()});
  startDemoQuiz(name);

  // Reset PDF sahifasi
  setTimeout(() => {
    document.getElementById('pdfSection').style.display    = 'block';
    document.getElementById('pdfProcessing').style.display = 'none';
    clearPdf();
    document.getElementById('pdfName').value = '';
  }, 500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QUIZ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DEMO_QS = [
  {q:'Python da list yaratish uchun:', opts:['(  )','[  ]','{  }','<  >'], ans:1, exp:'[] â€” kvadrat qavs'},
  {q:'HTML da sarlavha tegi:', opts:['<p>','<head>','<h1>','<title>'], ans:2, exp:'<h1> birinchi darajali sarlavha'},
  {q:'Internet protokoli:', opts:['FTP','HTTP','SSH','SMTP'], ans:1, exp:'HTTP â€” HyperText Transfer Protocol'},
  {q:'Python da funktsiya yaratish:', opts:['func','define','def','function'], ans:2, exp:'def â€” define qisqartmasi'},
  {q:'CSS da matn rangi:', opts:['text-color','font-color','color','text-style'], ans:2, exp:'color: red;'},
  {q:"SQL da ma'lumot olish:", opts:['GET','SELECT','FETCH','TAKE'], ans:1, exp:'SELECT * FROM table'},
  {q:"Git da saqlash buyrug'i:", opts:['git save','git commit','git push','git store'], ans:1, exp:'git commit -m "msg"'},
  {q:'2 ** 10 = ?', opts:['512','1024','2048','256'], ans:1, exp:'2^10 = 1024'},
  {q:'Loop turlari:', opts:['for, while','do, loop','repeat, cycle','run, go'], ans:0, exp:'for va while'},
  {q:'JSON nima uchun:', opts:["Rasm","Ma'lumot almashinuvi","Video","Audio"], ans:1, exp:'JavaScript Object Notation'},
];

let quizTimer = null, timeLeft = 1200;

function startDemoQuiz(name) {
  const shuffled = DEMO_QS.slice().sort(() => Math.random() - .5).slice(0,5);
  S.quiz = { questions:shuffled, current:0, answers:new Array(shuffled.length).fill(-1), score:0, testName:name };
  showPage('quiz');
  renderQuizQ();
  startQuizTimer();
  if (tg) {
    tg.BackButton.show();
    tg.BackButton.onClick(() => { clearInterval(quizTimer); showPage('home'); tg.BackButton.hide(); });
  }
}

function startQuizTimer() {
  clearInterval(quizTimer);
  timeLeft = S.quiz.questions.length * 60;
  quizTimer = setInterval(() => {
    timeLeft--;
    const m = Math.floor(timeLeft / 60), s = timeLeft % 60;
    const el = document.getElementById('qTimer');
    el.textContent = `â± ${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    el.classList.toggle('danger', timeLeft <= 30);
    if (timeLeft <= 0) { clearInterval(quizTimer); finishQuiz(); }
  }, 1000);
}

function renderQuizQ() {
  const {questions, current, answers} = S.quiz;
  const n = questions.length, q = questions[current];
  const answered = answers[current] !== -1;
  document.getElementById('qCounter').textContent = `${current+1} / ${n}`;
  document.getElementById('qPbar').style.width    = ((current)/n*100).toFixed(0) + '%';
  document.getElementById('qNum').textContent     = `SAVOL ${current+1}`;
  document.getElementById('qText').textContent    = q.q;
  const letters = ['A','B','C','D'];
  let optsHTML = q.opts.map((o,i) => {
    let cls = 'opt';
    if (answered) {
      if (i === q.ans)           cls = 'opt correct';
      else if (i === answers[current]) cls = 'opt wrong';
    } else if (i === answers[current]) cls = 'opt sel';
    const onclick = answered ? '' : `onclick="selectOpt(${i})"`;
    return `<div class="${cls}" ${onclick}><div class="opt-letter">${letters[i]}</div><span style="font-size:.85rem;font-weight:600;">${o}</span></div>`;
  }).join('');
  if (answered && q.exp) {
    optsHTML += `<div style="background:rgba(91,123,255,.07);border:1px solid rgba(91,123,255,.18);border-radius:11px;padding:.7rem;font-size:.75rem;color:var(--muted);margin-top:.4rem;">ğŸ’¡ ${q.exp}</div>`;
  }
  document.getElementById('qOptions').innerHTML = optsHTML;

  const btn = document.getElementById('qNextBtn');
  if (current < n-1) { btn.textContent='â†’'; btn.onclick=quizNext; }
  else                { btn.textContent='âœ… Yakunlash'; btn.onclick=finishQuiz; }

  document.getElementById('qDots').innerHTML = questions.map((_,i) =>
    `<div class="qdot${answers[i]!==-1?' ans':''}${i===current?' cur':''}" onclick="jumpQ(${i})"></div>`
  ).join('');
}

function selectOpt(i) {
  if (S.quiz.answers[S.quiz.current] !== -1) return;
  S.quiz.answers[S.quiz.current] = i;
  if (i === S.quiz.questions[S.quiz.current].ans) S.quiz.score++;
  if (tg) tg.HapticFeedback?.impactOccurred('light');
  renderQuizQ();
}
function quizNext() { if (S.quiz.current < S.quiz.questions.length-1) { S.quiz.current++; renderQuizQ(); } }
function quizPrev() { if (S.quiz.current > 0) { S.quiz.current--; renderQuizQ(); } }
function jumpQ(i)   { S.quiz.current = i; renderQuizQ(); }
function retryQuiz(){ S.quiz.current=0; S.quiz.answers=new Array(S.quiz.questions.length).fill(-1); S.quiz.score=0; showPage('quiz'); renderQuizQ(); }

function finishQuiz() {
  clearInterval(quizTimer);
  if (tg) { tg.BackButton.hide(); tg.HapticFeedback?.notificationOccurred('success'); }
  const {score, questions, testName} = S.quiz;
  const n = questions.length, pct = Math.round(score/n*100);
  const color = pct>=80 ? 'var(--green)' : pct>=50 ? 'var(--amber)' : 'var(--red)';
  const emoji = pct>=80 ? 'ğŸ†' : pct>=50 ? 'ğŸ’ª' : 'ğŸ“š';
  S.tests.push({name:testName, score:pct, date:new Date().toLocaleDateString()});
  document.getElementById('resultHero').innerHTML = `
    <div class="rh-ring" style="border-color:${color};">
      <div class="rh-pct" style="color:${color};">${pct}%</div>
      <div class="rh-sub">${score}/${n} to'g'ri</div>
    </div>
    <div style="font-family:'Sora',sans-serif;font-weight:800;font-size:1.1rem;margin-bottom:.2rem;">${emoji} Test yakunlandi!</div>
    <div style="font-size:.78rem;color:var(--muted);">${testName}</div>`;
  document.getElementById('resStats').innerHTML = `
    <div class="rs"><div class="rv" style="color:var(--green);">${score}</div><div class="rl">âœ… To'g'ri</div></div>
    <div class="rs"><div class="rv" style="color:var(--red);">${n-score}</div><div class="rl">âŒ Xato</div></div>
    <div class="rs"><div class="rv" style="color:var(--accent);">${pct}%</div><div class="rl">ğŸ“Š Ball</div></div>`;
  showPage('result');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PREMIUM & CREDITS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PKGS = [
  {id:'c10',  icon:'âš¡',   name:'10 ta kredit',  price:'9,900',  credits:10},
  {id:'c30',  icon:'âš¡âš¡', name:'30 ta kredit',  price:'24,900', credits:30,  popular:true},
  {id:'c100', icon:'ğŸ”¥',   name:'100 ta kredit', price:'69,900', credits:100},
];
const PLANS = [
  {id:'month', name:'1 Oy',    price:'24,990', priceval:24990,  days:30,  credits:50},
  {id:'quart', name:'3 Oy ğŸ”¥', price:'64,990', priceval:64990,  days:90,  credits:150, popular:true},
  {id:'year',  name:'1 Yil âš¡',price:'150,000',priceval:150000, days:365, credits:1000},
];

function renderCreditPackages() {
  document.getElementById('creditPackages').innerHTML = PKGS.map(p => `
    <div class="pkg-card${p.popular?' pop':''}" onclick="buyCreditPkg('${p.id}')">
      ${p.popular ? '<div class="pkg-hot">ğŸ”¥ Ommabop</div>' : ''}
      <div class="pkg-icon" style="background:rgba(245,158,11,.08);">${p.icon}</div>
      <div class="pkg-body">
        <div class="pkg-name">${p.name}</div>
        <div class="pkg-price">${p.price} so'm</div>
      </div>
    </div>`).join('');
}

function buyCreditPkg(id) {
  const pkg = PKGS.find(p => p.id === id);
  if (pkg) toast(`ğŸ’³ ${pkg.name} â€” ${pkg.price} so'm (To'lov tizimi ulanmagan)`);
}

function renderPremiumPlans() {
  document.getElementById('premiumPlans').innerHTML = PLANS.map(p => `
    <div class="plan-card${p.popular?' pop':''}" id="plan_${p.id}" onclick="selPlan('${p.id}')">
      ${p.popular ? '<div class="pkg-hot">ğŸ”¥ Ommabop</div>' : ''}
      <div class="pc-top">
        <div><div class="pc-name">${p.name}</div><div class="pc-sub">${p.days} kun</div></div>
        <div style="text-align:right;"><div class="pc-price">${p.price}</div><div class="pc-sub">so'm</div></div>
      </div>
      <div class="pc-feats">
        <span class="pc-feat">â™¾ï¸ Cheksiz PDF</span>
        <span class="pc-feat">â™¾ï¸ Cheksiz AI</span>
        <span class="pc-feat">âœï¸ Cheksiz Maqola</span>
        <span class="pc-feat">âš¡ +${p.credits} kredit</span>
      </div>
    </div>`).join('');
}

function selPlan(id) {
  S.selPlanId = id;
  document.querySelectorAll('.plan-card').forEach(c => c.classList.remove('sel'));
  document.getElementById('plan_'+id)?.classList.add('sel');
  const plan = PLANS.find(p => p.id === id);
  document.getElementById('payMethodCard').style.display = 'block';
  document.getElementById('payBtn').textContent = `ğŸ’³ To'lash â€” ${plan.price} so'm`;
}

function selPayMethod(m, el) {
  S.payMethod = m;
  document.querySelectorAll('.pay-m').forEach(e => e.classList.remove('sel'));
  el.classList.add('sel');
}

async function processPay() {
  const plan = PLANS.find(p => p.id === S.selPlanId);
  if (!plan) { toast("âš ï¸ Tarif tanlang!"); return; }
  const btn = document.getElementById('payBtn');
  btn.textContent = 'â³ Kutib turing...';
  btn.disabled = true;
  await sleep(2200);
  S.isPremium = true; S.plan = plan.id;
  S.credits += plan.credits;
  updateCreditsDisplay();
  toast('ğŸ‰ Premium faollashtirildi!');
  btn.textContent = 'âœ… Faollashtirildi!';
  updateProfile();
  if (tg) tg.HapticFeedback?.notificationOccurred('success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GROUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function createSession() {
  const code = 'QUIZ' + Math.floor(1000 + Math.random()*9000);
  toast('âœ… Sessiya: ' + code);
  navigator.clipboard?.writeText(code);
}

function joinSession() {
  const code = document.getElementById('sessionCode').value.trim().toUpperCase();
  if (code.length < 4) { toast('âš ï¸ Kodni kiriting!'); return; }
  toast('âœ… ' + code + " sessiyasiga qo'shilindi!");
  setTimeout(() => startDemoQuiz('Guruh testi'), 500);
}

function renderLeaderboard() {
  const l = [
    {name:'Sardor', score:95, icon:'ğŸ¥‡'},
    {name:'Malika', score:88, icon:'ğŸ¥ˆ'},
    {name:'Bobur',  score:82, icon:'ğŸ¥‰'},
    {name:'Zulfiya',score:76, icon:'4ï¸âƒ£'},
    {name:'Jasur',  score:71, icon:'5ï¸âƒ£'},
  ];
  document.getElementById('leaderboard').innerHTML = l.map(x =>
    `<div style="display:flex;align-items:center;gap:.65rem;padding:.6rem;background:var(--card);border-radius:11px;margin-bottom:.45rem;border:1px solid var(--border);">
      <div style="font-size:1rem;">${x.icon}</div>
      <div style="flex:1;font-weight:700;font-size:.82rem;">${x.name}</div>
      <div style="font-family:'Sora',sans-serif;font-weight:800;color:var(--accent);">${x.score}%</div>
    </div>`
  ).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRESENTATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PRES_STYLES = [
  {id:'business', icon:'ğŸ’¼', name:'Business'},
  {id:'creative', icon:'ğŸ¨', name:'Creative'},
  {id:'academic', icon:'ğŸ“', name:'Academic'},
  {id:'startup',  icon:'ğŸš€', name:'Startup'},
];

function renderPresOptions() {
  document.getElementById('presCountPills').innerHTML = [5,8,10,15,20].map(n =>
    `<div class="cpill${n===10?' sel':''}" onclick="selPresCount(${n},this)">${n}</div>`
  ).join('');
  document.getElementById('presStyles').innerHTML = PRES_STYLES.map((s,i) =>
    `<div class="choice-btn${i===0?' sel':''}" onclick="selPresStyle('${s.id}',this)"><div class="cb-icon">${s.icon}</div><div class="cb-name">${s.name}</div></div>`
  ).join('');
}

function selPresCount(n, el) {
  S.presOpts.slides = n;
  document.querySelectorAll('#presCountPills .cpill').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
}
function selPresStyle(s, el) {
  S.presOpts.style = s;
  el.closest('#presStyles').querySelectorAll('.choice-btn').forEach(c => c.classList.remove('sel'));
  el.classList.add('sel');
}

async function startPresGen() {
  const topic = document.getElementById('presTitle').value.trim();
  if (!topic) { toast('âš ï¸ Mavzuni kiriting!'); return; }
  if (S.credits < 3 && !S.isPremium) { toast('âš¡ 3 kredit kerak!'); showPage('credits'); return; }
  document.getElementById('presSection').style.display      = 'none';
  document.getElementById('presGenProgress').style.display  = 'block';
  const steps = [
    {t:'ğŸ§  Mavzu tahlil...', p:20},
    {t:'ğŸ“ Slaydlar yaratilmoqda...', p:50},
    {t:'ğŸ¨ Dizayn...', p:80},
    {t:'ğŸ“¦ Fayl tayyor...', p:100},
  ];
  for (const s of steps) {
    await sleep(950);
    document.getElementById('presPbar').style.width     = s.p + '%';
    document.getElementById('presPbarText').textContent = s.t;
  }
  await sleep(300);
  if (!S.isPremium) { S.credits -= 3; updateCreditsDisplay(); }
  toast('âœ… Prezentatsiya tayyor!');
  document.getElementById('presSection').style.display     = 'block';
  document.getElementById('presGenProgress').style.display = 'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REFERRAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function copyRef() {
  navigator.clipboard?.writeText(document.getElementById('refLink').textContent)
    .then(() => toast("ğŸ“‹ Havola nusxa olindi!"));
  if (tg) tg.HapticFeedback?.impactOccurred('light');
}
function shareRef() {
  if (tg) tg.switchInlineQuery('âš¡ Slide Mind!\n' + document.getElementById('refLink').textContent, ['users']);
  else toast('Telegram da oching!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROFILE & CREDITS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateProfile() {
  document.getElementById('profName').textContent = S.name;
  const badge = document.getElementById('profPlan');
  badge.textContent = S.isPremium ? 'ğŸ‘‘ Premium' : 'ğŸ Bepul tarif';
  badge.className   = 'prof-plan ' + (S.isPremium ? 'plan-premium' : 'plan-free');
  document.getElementById('pTests').textContent  = S.tests.length;
  document.getElementById('pCredit').textContent = S.credits;
}
function updateCredits() {
  document.getElementById('creditsNum').textContent    = S.credits;
  document.getElementById('pdfCreditShow').textContent = S.credits;
}
function updateCreditsDisplay() {
  document.getElementById('creditCount').textContent   = S.credits;
  document.getElementById('creditsNum').textContent    = S.credits;
  document.getElementById('pdfCreditShow').textContent = S.credits;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST & UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg) {
  const wrap = document.getElementById('toastWrap');
  const el   = document.createElement('div');
  el.className   = 'toast';
  el.textContent = msg;
  wrap.appendChild(el);
  requestAnimationFrame(() => requestAnimationFrame(() => el.classList.add('show')));
  setTimeout(() => { el.style.opacity='0'; setTimeout(() => el.remove(), 300); }, 2500);
}

function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX: init() FAQAT BIR MARTA chaqiriladi (pastda)
// DOMContentLoaded olib tashlandi â€” pastdagi init() yetarli
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {
  buildNav();
  initBanners();
  renderTopicSugs();
  renderAiCountPills();
  renderCreditPackages();
  renderPremiumPlans();
  renderLeaderboard();
  renderPresOptions();
  renderArticleUI();
  document.getElementById('helloText').textContent = 'âš¡ Salom, ' + S.name + '!';
  updateCreditsDisplay();

  // Referral havolasini o'rnatish
  const uid = tg?.initDataUnsafe?.user?.id || '12345';
  document.getElementById('refLink').textContent = `https://t.me/QuizBotPro?start=REF${uid}`;
}

// Script body oxirida â€” DOM tayyor bo'lganda ishlaydi
init();
</script>
</body>
</html>
